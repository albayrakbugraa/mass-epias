-- MASS_SUBSCRIPTION_DETAILS tablosu
CREATE TABLE MASS_SUBSCRIPTION_DETAILS (
    SUBSCRIPTION_DETAIL_ID  NUMBER GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) NOT NULL, -- Otomatik artan ID
    SUBSCRIPTION_KEY        VARCHAR2(100 CHAR) NOT NULL,  -- Abonelik anahtarı
    ADDRESS                 VARCHAR2(500 CHAR),            -- Tüketim yeri adresi
    ETSO_CODE               VARCHAR2(50 CHAR),             -- ETSO kodu
    CONTRACT_ACCOUNT_NUMBER VARCHAR2(50 CHAR),             -- Sözleşme numarası
    UNEXPECTED_USAGE_THRESHOLD NUMBER(10,2),               -- Beklenmedik tüketim eşiği
    USAGE_LIMIT_THRESHOLD   NUMBER(10,2),                  -- Tüketim limiti eşiği
    CONSUMER_GROUP          VARCHAR2(100 CHAR),            -- Tüketici grubu (ör: Mesken)
    CONSUMER_CLASS          VARCHAR2(200 CHAR),            -- Tüketici sınıfı açıklaması
    CREATED_AT              TIMESTAMP(6) WITH LOCAL TIME ZONE DEFAULT SYSTIMESTAMP NOT NULL, -- Oluşturulma tarihi
    UPDATED_AT              TIMESTAMP(6) WITH LOCAL TIME ZONE, -- Güncellenme tarihi

    CONSTRAINT PK_MASS_SUBSCRIPTION_DETAILS PRIMARY KEY (SUBSCRIPTION_DETAIL_ID),
    CONSTRAINT FK_SUBSCRIPTION_DETAILS_TO_SUBS FOREIGN KEY (SUBSCRIPTION_KEY)
        REFERENCES MASS_SUBSCRIPTIONS(SUBSCRIPTION_KEY)
        ON DELETE CASCADE
);

-- UNIQUE constraint (Her abonelik için yalnızca bir detay kaydı)
CREATE UNIQUE INDEX UK_MASS_SUBSCRIPTION_DETAILS_KEY ON MASS_SUBSCRIPTION_DETAILS (SUBSCRIPTION_KEY);

-- Performans için ek indekS
CREATE INDEX IDX_SUBS_DETAILS_GROUP ON MASS_SUBSCRIPTION_DETAILS (CONSUMER_GROUP);

-- Yorumlar 
COMMENT ON TABLE MASS_SUBSCRIPTION_DETAILS IS 'MASS projesinde abonelik detaylarını tutar. Her SUBSCRIPTION_KEY için birebir detay bilgisi içerir.';

COMMENT ON COLUMN MASS_SUBSCRIPTION_DETAILS.SUBSCRIPTION_DETAIL_ID IS 'Abonelik detay kaydı için benzersiz tanıtıcı (otomatik artan).';
COMMENT ON COLUMN MASS_SUBSCRIPTION_DETAILS.SUBSCRIPTION_KEY IS 'Abonelik anahtarı, MASS_SUBSCRIPTIONS ile birebir ilişkilidir.';
COMMENT ON COLUMN MASS_SUBSCRIPTION_DETAILS.ADDRESS IS 'Tüketim noktasına ait adres bilgisi.';
COMMENT ON COLUMN MASS_SUBSCRIPTION_DETAILS.ETSO_CODE IS 'Tüketiciye ait ETSO kodu.';
COMMENT ON COLUMN MASS_SUBSCRIPTION_DETAILS.CONTRACT_ACCOUNT_NUMBER IS 'Sözleşme (abonelik) numarası.';
COMMENT ON COLUMN MASS_SUBSCRIPTION_DETAILS.UNEXPECTED_USAGE_THRESHOLD IS 'Beklenmedik tüketim eşiği.';
COMMENT ON COLUMN MASS_SUBSCRIPTION_DETAILS.USAGE_LIMIT_THRESHOLD IS 'Tüketim limiti eşiği.';
COMMENT ON COLUMN MASS_SUBSCRIPTION_DETAILS.CONSUMER_GROUP IS 'Tüketici grubu (örneğin: Mesken).';
COMMENT ON COLUMN MASS_SUBSCRIPTION_DETAILS.CONSUMER_CLASS IS 'Tüketici sınıfı açıklaması.';
COMMENT ON COLUMN MASS_SUBSCRIPTION_DETAILS.CREATED_AT IS 'Kayıt oluşturulma tarihi.';
COMMENT ON COLUMN MASS_SUBSCRIPTION_DETAILS.UPDATED_AT IS 'Kayıt güncellenme tarihi.';
